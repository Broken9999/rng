<!DOCTYPE html>
<html>
<head>
  <title>Infinite RNG with Mutations</title>
  <style>
    body {
      font-family: Arial Rounded, sans-serif;
      background-color: #111;
      color: #fff;
      text-align: center;
      padding: 40px;
    }
    button {
      font-size: 16px;
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 20px;
      background-color: #ffcc00;
      color: #111;
      cursor: pointer;
    }
    button:hover {
      background-color: #ffe066;
    }
    .result, .history, .leaderboard {
      font-size: 18px;
      margin-top: 20px;
    }
    .inventory {
      margin-top: 30px;
      text-align: left;
      display: inline-block;
      font-size: 15px;
      max-height: 300px;
      overflow-y: auto;
      width: 60%;
    }
    .rarity-2 { color: #ccc; }
    .rarity-5 { color: #66cc66; }
    .rarity-10 { color: #3399ff; }
    .rarity-25 { color: #cc66ff; }
    .rarity-50 { color: #ff9900; }
    .rarity-100 { color: gold; font-weight: bold; }
    .mutation { color: #ff66cc; font-style: italic; }
  </style>
</head>
<body>

  <h1>üé≤ Infinite RNG + Mutations + Leaderboard</h1>
  <div>
    <button onclick="roll(1)">Roll x1</button>
    <button onclick="roll(10)">Roll x10</button>
    <button onclick="roll(100)">Roll x100</button>
    <button onclick="toggleAutoRoll()">
      <span id="autoLabel">Start Auto Roll</span>
    </button>
  </div>

  <div class="result" id="resultText">?</div>
  <div class="history" id="rollHistory"></div>
  <div class="leaderboard" id="leaderboard"></div>
  <div class="inventory" id="inventoryDisplay"></div>

  <script>
    const inventory = JSON.parse(localStorage.getItem("rng-inventory")) || {};
    const oddsList = [];
    let maxOdds = 100;
    let autoRolling = false;
    let autoInterval;
    const history = [];
    let lastRoll = null;
    let topRolls = JSON.parse(localStorage.getItem("top-rolls")) || [];

    const mutations = [];
    for (let i = 0; i < 50; i++) {
      let multiplier = (Math.random() * 9.9 + 1.1).toFixed(1); // x1.1 to x11.0
      mutations.push(`x${multiplier}`);
    }

    // Initialize base odds
    [2, 5, 10, 25, 50, 100].forEach(o => {
      const label = `(1 in ${o})`;
      oddsList.push({ odds: o, label });
      if (!(label in inventory)) inventory[label] = 0;
    });

    function addNewOddsTier() {
      maxOdds++;
      const newLabel = `(1 in ${maxOdds})`;
      oddsList.push({ odds: maxOdds, label: newLabel });
      if (!(newLabel in inventory)) inventory[newLabel] = 0;
    }

    function getRandomRoll() {
      // Randomly expand pool
      if (Math.random() < 0.25) addNewOddsTier();

      const item = oddsList[Math.floor(Math.random() * oddsList.length)];

      // Mutation
      const mutation = mutations[Math.floor(Math.random() * mutations.length)];
      const multiplier = parseFloat(mutation.replace("x", ""));
      const finalOdds = Math.floor(item.odds * multiplier);
      const finalLabel = `(1 in ${finalOdds}) [${mutation}]`;

      const chance = 1 / finalOdds;
      if (Math.random() <= chance) {
        return {
          label: finalLabel,
          odds: finalOdds,
          mutation
        };
      } else {
        return null;
      }
    }

    function roll(times = 1) {
      for (let t = 0; t < times; t++) {
        let result = null;
        while (!result) result = getRandomRoll();

        const timestamp = new Date().toLocaleString();
        if (!inventory[result.label]) inventory[result.label] = 0;
        inventory[result.label]++;
        lastRoll = { label: result.label, time: timestamp };
        history.unshift(result.label);
        if (history.length > 5) history.pop();

        topRolls.push({ label: result.label, odds: result.odds, time: timestamp });
        topRolls.sort((a, b) => b.odds - a.odds);
        topRolls = topRolls.slice(0, 3);
      }

      localStorage.setItem("rng-inventory", JSON.stringify(inventory));
      localStorage.setItem("top-rolls", JSON.stringify(topRolls));
      updateDisplay();
    }

    function updateDisplay() {
      const last = lastRoll;
      document.getElementById("resultText").innerHTML = last
        ? `Latest roll: <strong class="${getRarityClass(last.label)}">${last.label}</strong> <br><small>${last.time}</small>`
        : "?";

      let histHTML = `<strong>Recent Rolls:</strong><br>`;
      history.forEach(item => {
        histHTML += `<span class="${getRarityClass(item)}">${item}</span><br>`;
      });
      document.getElementById("rollHistory").innerHTML = histHTML;

      renderTopRolls();

      let html = `<strong>Inventory:</strong><br>`;
      Object.entries(inventory).forEach(([label, count]) => {
        if (count > 0) {
          html += `<span class="${getRarityClass(label)}">${label}</span> x${count}<br>`;
        }
      });
      document.getElementById("inventoryDisplay").innerHTML = html;
    }

    function renderTopRolls() {
      let topHTML = `<strong>üåç Top 3 Global Rolls:</strong><br>`;
      topRolls.forEach((item, index) => {
        topHTML += `${index + 1}. <span class="${getRarityClass(item.label)}">${item.label}</span><br><small>${item.time}</small><br>`;
      });
      document.getElementById("leaderboard").innerHTML = topHTML;
    }

    function toggleAutoRoll() {
      autoRolling = !autoRolling;
      document.getElementById("autoLabel").textContent =
        autoRolling ? "Stop Auto Roll" : "Start Auto Roll";

      if (autoRolling) {
        autoInterval = setInterval(() => roll(1), 500);
      } else {
        clearInterval(autoInterval);
      }
    }

    function getRarityClass(label) {
      const num = parseInt(label.match(/\d+/));
      if (num <= 2) return "rarity-2";
      if (num <= 5) return "rarity-5";
      if (num <= 10) return "rarity-10";
      if (num <= 25) return "rarity-25";
      if (num <= 50) return "rarity-50";
      return "rarity-100";
    }

    updateDisplay();
    setInterval(renderTopRolls, 20000); // Update top rolls every 20 sec
  </script>

</body>
</html>
